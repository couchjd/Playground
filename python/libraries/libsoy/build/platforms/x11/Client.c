/* Client.c generated by valac 0.22.1, the Vala compiler
 * generated from Client.gs, do not modify */

/*
 *  libsoy - soy.Client for X11
 *  Copyright (C) 2006-2014 Copyleft Games Group
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU Affero General Public License as published
 *  by the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU Affero General Public License for more details.
 *
 *  You should have received a copy of the GNU Affero General Public License
 *  along with this program; if not, see http://www.gnu.org/licenses
 *
 */

#include <glib.h>
#include <glib-object.h>
#include <X11/Xlib.h>
#include <X11/Xatom.h>
#include <X11/Xutil.h>
#include <X11/Xregion.h>
#include <stdlib.h>
#include <string.h>
#include <soy-1/soy.h>
#include <EGL/egl.h>
#include <float.h>
#include <math.h>


#define SOY_TYPE_CLIENT (soy_client_get_type ())
#define SOY_CLIENT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), SOY_TYPE_CLIENT, soyClient))
#define SOY_CLIENT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), SOY_TYPE_CLIENT, soyClientClass))
#define SOY_IS_CLIENT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), SOY_TYPE_CLIENT))
#define SOY_IS_CLIENT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), SOY_TYPE_CLIENT))
#define SOY_CLIENT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), SOY_TYPE_CLIENT, soyClientClass))

typedef struct _soyClient soyClient;
typedef struct _soyClientClass soyClientClass;
typedef struct _soyClientPrivate soyClientPrivate;
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _XCloseDisplay0(var) ((var == NULL) ? NULL : (var = (XCloseDisplay (var), NULL)))
typedef struct _soy_WindowSource soy_WindowSource;

#define SOY_TYPE__CLIENTTHREAD (soy__clientthread_get_type ())
#define SOY__CLIENTTHREAD(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), SOY_TYPE__CLIENTTHREAD, soy_ClientThread))
#define SOY__CLIENTTHREAD_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), SOY_TYPE__CLIENTTHREAD, soy_ClientThreadClass))
#define SOY_IS__CLIENTTHREAD(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), SOY_TYPE__CLIENTTHREAD))
#define SOY_IS__CLIENTTHREAD_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), SOY_TYPE__CLIENTTHREAD))
#define SOY__CLIENTTHREAD_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), SOY_TYPE__CLIENTTHREAD, soy_ClientThreadClass))

typedef struct _soy_ClientThread soy_ClientThread;
typedef struct _soy_ClientThreadClass soy_ClientThreadClass;
typedef struct _soy_ClientThreadPrivate soy_ClientThreadPrivate;
#define _g_source_unref0(var) ((var == NULL) ? NULL : (var = (g_source_unref (var), NULL)))

struct _soyClient {
	GObject parent_instance;
	soyClientPrivate * priv;
	gboolean closing;
	Display* xDisplay;
};

struct _soyClientClass {
	GObjectClass parent_class;
};

struct _soyClientPrivate {
	gchar* _address;
	soywidgetsWindow* _window;
	EGLConfig _eglConfig;
	EGLContext _eglContext;
	EGLDisplay _eglDisplay;
	EGLSurface* _eglSurface;
	soyatomsSize* _window_size;
	Atom _wm_delete_window;
	XVisualInfo _xVisInfo;
	Window* _xWindow;
};

struct _soy_ClientThread {
	GObject parent_instance;
	soy_ClientThreadPrivate * priv;
	GMainContext* context;
};

struct _soy_ClientThreadClass {
	GObjectClass parent_class;
};


static gpointer soy_client_parent_class = NULL;
extern soy_ClientThread* soy__client_thread;

GType soy_client_get_type (void) G_GNUC_CONST;
#define SOY_CLIENT_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), SOY_TYPE_CLIENT, soyClientPrivate))
enum  {
	SOY_CLIENT_DUMMY_PROPERTY,
	SOY_CLIENT_ADDRESS,
	SOY_CLIENT_WINDOW
};
gboolean soy_client_thread_step (soyClient* self);
soy_WindowSource* soy__windowsource_new (soyClient* c);
soy_WindowSource* soy__windowsource_new (soyClient* c);
GType soy__clientthread_get_type (void) G_GNUC_CONST;
static Window* _window_dup (Window* self);
void soy_client_window_client (soyClient* self, XClientMessageEvent* event);
void soy_client_window_config (soyClient* self, XConfigureEvent* event);
soywidgetsWindow* soy_client_get_window (soyClient* self);
void soy_client_window_draw (soyClient* self, XExposeEvent* event);
void soy_client_window_opened (soyClient* self, XCreateWindowEvent* event);
static EGLSurface* _egl_surface_dup (EGLSurface* self);
void soy_client_window_resize (soyClient* self, soyatomsSize* size);
soyClient* soy_client_new (void);
soyClient* soy_client_construct (GType object_type);
const gchar* soy_client_get_address (soyClient* self);
static GObject * soy_client_constructor (GType type, guint n_construct_properties, GObjectConstructParam * construct_properties);
static void _soy_client_window_resize_soy_atoms_size_on_set (soyatomsSize* _sender, soyatomsSize* size, gpointer self);
soy_ClientThread* soy__clientthread_new (void);
soy_ClientThread* soy__clientthread_construct (GType object_type);
static gboolean _soy_client_thread_step_gsource_func (gpointer self);
static void soy_client_finalize (GObject* obj);
static void _vala_soy_client_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec);


static Window* _window_dup (Window* self) {
	Window* dup;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	dup = g_new0 (Window, 1);
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	memcpy (dup, self, sizeof (Window));
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return dup;
#line 142 "Client.c"
}


static gpointer __window_dup0 (gpointer self) {
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return self ? _window_dup (self) : NULL;
#line 149 "Client.c"
}


gboolean soy_client_thread_step (soyClient* self) {
	gboolean result = FALSE;
	gint major = 0;
	gint minor = 0;
	gint matches = 0;
	XSetWindowAttributes winattr = {0};
	gboolean _tmp0_ = FALSE;
	Window* _tmp1_ = NULL;
	Display* _tmp6_ = NULL;
	Window* _tmp56_ = NULL;
#line 84 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_val_if_fail (self != NULL, FALSE);
#line 88 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	memset (&winattr, 0, sizeof (XSetWindowAttributes));
#line 91 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = self->closing;
#line 91 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if (_tmp0_) {
#line 92 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_g_free0 (self->priv->_xWindow);
#line 92 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->priv->_xWindow = NULL;
#line 93 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_XCloseDisplay0 (self->xDisplay);
#line 93 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->xDisplay = NULL;
#line 94 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		result = FALSE;
#line 94 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		return result;
#line 183 "Client.c"
	}
#line 98 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp1_ = self->priv->_xWindow;
#line 98 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if (_tmp1_ != NULL) {
#line 189 "Client.c"
		Display* _tmp2_ = NULL;
		Display* _tmp5_ = NULL;
#line 119 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp2_ = self->xDisplay;
#line 119 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (_tmp2_ != NULL) {
#line 196 "Client.c"
			Display* _tmp3_ = NULL;
			Window* _tmp4_ = NULL;
#line 120 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp3_ = self->xDisplay;
#line 120 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp4_ = self->priv->_xWindow;
#line 120 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			XClearArea (_tmp3_, *_tmp4_, 0, 0, (guint) 0, (guint) 0, TRUE);
#line 205 "Client.c"
		}
#line 122 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp5_ = self->xDisplay;
#line 122 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		XFlush (_tmp5_);
#line 123 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		result = TRUE;
#line 123 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		return result;
#line 215 "Client.c"
	}
#line 127 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp6_ = self->xDisplay;
#line 127 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if (_tmp6_ == NULL) {
#line 221 "Client.c"
		Display* _tmp7_ = NULL;
		Display* _tmp8_ = NULL;
		Display* _tmp9_ = NULL;
		gint _tmp10_ = 0;
		XVisualInfo* _tmp11_ = NULL;
		XVisualInfo* _tmp12_ = NULL;
		gint _tmp13_ = 0;
		gint visualid = 0;
		XVisualInfo _tmp14_ = {0};
		VisualID _tmp15_ = {0};
		EGLint* egl_attrs = NULL;
		gint _tmp16_ = 0;
		EGLint* _tmp17_ = NULL;
		gint egl_attrs_length1 = 0;
		gint _egl_attrs_size_ = 0;
		EGLint* ctx_attrs = NULL;
		EGLint* _tmp18_ = NULL;
		gint ctx_attrs_length1 = 0;
		gint _ctx_attrs_size_ = 0;
		Display* _tmp19_ = NULL;
		EGLDisplay _tmp20_ = 0;
		EGLDisplay _tmp21_ = 0;
		EGLint _tmp22_ = 0;
		EGLint _tmp23_ = 0;
		EGLBoolean _tmp24_ = FALSE;
		gboolean _tmp25_ = FALSE;
		gint _tmp26_ = 0;
		gboolean _tmp28_ = FALSE;
		EGLConfig* configs = NULL;
		EGLConfig _tmp31_ = 0;
		EGLConfig* _tmp32_ = NULL;
		gint configs_length1 = 0;
		gint _configs_size_ = 0;
		gboolean _tmp33_ = FALSE;
		EGLDisplay _tmp34_ = 0;
		EGLint* _tmp35_ = NULL;
		gint _tmp35__length1 = 0;
		EGLConfig* _tmp36_ = NULL;
		gint _tmp36__length1 = 0;
		EGLint _tmp37_ = 0;
		EGLBoolean _tmp38_ = FALSE;
		gboolean _tmp40_ = FALSE;
		EGLConfig* _tmp41_ = NULL;
		gint _tmp41__length1 = 0;
		EGLConfig _tmp42_ = 0;
		EGLDisplay _tmp43_ = 0;
		EGLConfig _tmp44_ = 0;
		EGLint* _tmp45_ = NULL;
		gint _tmp45__length1 = 0;
		EGLContext _tmp46_ = 0;
		EGLContext _tmp47_ = 0;
		Display* _tmp48_ = NULL;
		Display* _tmp49_ = NULL;
		Window _tmp50_ = 0;
		XSetWindowAttributes _tmp51_ = {0};
		soy_WindowSource* windowsrc = NULL;
		soy_WindowSource* _tmp52_ = NULL;
		soy_WindowSource* _tmp53_ = NULL;
		soy_ClientThread* _tmp54_ = NULL;
		GMainContext* _tmp55_ = NULL;
#line 130 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp7_ = XOpenDisplay (NULL);
#line 130 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_XCloseDisplay0 (self->xDisplay);
#line 130 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->xDisplay = _tmp7_;
#line 131 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp8_ = self->xDisplay;
#line 131 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (_tmp8_ == NULL) {
#line 132 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			g_print ("Could not open X11 display.\n");
#line 133 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			result = FALSE;
#line 133 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			return result;
#line 298 "Client.c"
		}
#line 136 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp9_ = self->xDisplay;
#line 136 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp11_ = XGetVisualInfo (_tmp9_, (glong) 0, NULL, &_tmp10_);
#line 136 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		matches = _tmp10_;
#line 136 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp12_ = _tmp11_;
#line 136 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->priv->_xVisInfo = *_tmp12_;
#line 136 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_g_free0 (_tmp12_);
#line 137 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp13_ = matches;
#line 137 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (_tmp13_ == 0) {
#line 138 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			g_print ("Could not get XVisual\n");
#line 139 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			result = FALSE;
#line 139 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			return result;
#line 322 "Client.c"
		}
#line 140 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp14_ = self->priv->_xVisInfo;
#line 140 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp15_ = _tmp14_.visualid;
#line 140 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		visualid = (gint) _tmp15_;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp16_ = visualid;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_ = g_new0 (EGLint, 9);
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[0] = EGL_RENDERABLE_TYPE;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[1] = EGL_OPENGL_ES2_BIT;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[2] = EGL_NATIVE_VISUAL_ID;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[3] = (EGLint) _tmp16_;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[4] = EGL_DEPTH_SIZE;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[5] = (EGLint) 16;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[6] = EGL_STENCIL_SIZE;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[7] = (EGLint) 1;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp17_[8] = EGL_NONE;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		egl_attrs = _tmp17_;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		egl_attrs_length1 = 9;
#line 143 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_egl_attrs_size_ = egl_attrs_length1;
#line 151 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp18_ = g_new0 (EGLint, 3);
#line 151 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp18_[0] = EGL_CONTEXT_CLIENT_VERSION;
#line 151 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp18_[1] = (EGLint) 2;
#line 151 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp18_[2] = EGL_NONE;
#line 151 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		ctx_attrs = _tmp18_;
#line 151 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		ctx_attrs_length1 = 3;
#line 151 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_ctx_attrs_size_ = ctx_attrs_length1;
#line 175 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp19_ = self->xDisplay;
#line 175 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp20_ = eglGetDisplay (_tmp19_);
#line 175 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->priv->_eglDisplay = _tmp20_;
#line 176 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp21_ = self->priv->_eglDisplay;
#line 176 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp24_ = eglInitialize (_tmp21_, &_tmp22_, &_tmp23_);
#line 176 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		major = (gint) _tmp22_;
#line 176 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		minor = (gint) _tmp23_;
#line 176 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if ((gboolean) (!_tmp24_)) {
#line 177 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			g_print ("Failed to initialize EGL.\n");
#line 178 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			result = FALSE;
#line 178 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			ctx_attrs = (g_free (ctx_attrs), NULL);
#line 178 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			egl_attrs = (g_free (egl_attrs), NULL);
#line 178 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			return result;
#line 398 "Client.c"
		}
#line 181 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp26_ = major;
#line 181 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (_tmp26_ != 1) {
#line 181 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp25_ = TRUE;
#line 406 "Client.c"
		} else {
			gint _tmp27_ = 0;
#line 181 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp27_ = minor;
#line 181 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp25_ = _tmp27_ < 3;
#line 413 "Client.c"
		}
#line 181 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp28_ = _tmp25_;
#line 181 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (_tmp28_) {
#line 419 "Client.c"
			gint _tmp29_ = 0;
			gint _tmp30_ = 0;
#line 182 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp29_ = major;
#line 182 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp30_ = minor;
#line 182 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			g_print ("EGL version %i.%i not supported.\n", _tmp29_, _tmp30_);
#line 183 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			result = FALSE;
#line 183 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			ctx_attrs = (g_free (ctx_attrs), NULL);
#line 183 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			egl_attrs = (g_free (egl_attrs), NULL);
#line 183 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			return result;
#line 436 "Client.c"
		}
#line 185 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp31_ = self->priv->_eglConfig;
#line 185 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp32_ = g_new0 (EGLConfig, 1);
#line 185 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp32_[0] = _tmp31_;
#line 185 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		configs = _tmp32_;
#line 185 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		configs_length1 = 1;
#line 185 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_configs_size_ = configs_length1;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp34_ = self->priv->_eglDisplay;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp35_ = egl_attrs;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp35__length1 = egl_attrs_length1;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp36_ = configs;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp36__length1 = configs_length1;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp38_ = eglChooseConfig (_tmp34_, _tmp35_, _tmp36_, _tmp36__length1, &_tmp37_);
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		matches = (gint) _tmp37_;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if ((gboolean) (!_tmp38_)) {
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp33_ = TRUE;
#line 468 "Client.c"
		} else {
			gint _tmp39_ = 0;
#line 187 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp39_ = matches;
#line 187 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			_tmp33_ = _tmp39_ == 0;
#line 475 "Client.c"
		}
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp40_ = _tmp33_;
#line 186 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (_tmp40_) {
#line 188 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			g_print ("EGL configuration failed.\n");
#line 483 "Client.c"
		}
#line 189 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp41_ = configs;
#line 189 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp41__length1 = configs_length1;
#line 189 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp42_ = _tmp41_[0];
#line 189 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->priv->_eglConfig = _tmp42_;
#line 191 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		eglBindAPI (EGL_OPENGL_ES_API);
#line 194 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp43_ = self->priv->_eglDisplay;
#line 194 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp44_ = self->priv->_eglConfig;
#line 194 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp45_ = ctx_attrs;
#line 194 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp45__length1 = ctx_attrs_length1;
#line 194 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp46_ = eglCreateContext (_tmp43_, _tmp44_, EGL_NO_CONTEXT, _tmp45_);
#line 194 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->priv->_eglContext = _tmp46_;
#line 196 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp47_ = self->priv->_eglContext;
#line 196 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (_tmp47_ == EGL_NO_CONTEXT) {
#line 197 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			g_print ("Could not create EGL context\n");
#line 198 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			result = FALSE;
#line 198 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			configs = (g_free (configs), NULL);
#line 198 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			ctx_attrs = (g_free (ctx_attrs), NULL);
#line 198 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			egl_attrs = (g_free (egl_attrs), NULL);
#line 198 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			return result;
#line 523 "Client.c"
		}
#line 201 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		winattr.event_mask = (glong) SubstructureNotifyMask;
#line 202 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp48_ = self->xDisplay;
#line 202 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp49_ = self->xDisplay;
#line 202 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp50_ = DefaultRootWindow (_tmp49_);
#line 202 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp51_ = winattr;
#line 202 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		XChangeWindowAttributes (_tmp48_, _tmp50_, (gulong) CWEventMask, &_tmp51_);
#line 209 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp52_ = soy__windowsource_new (self);
#line 209 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		windowsrc = _tmp52_;
#line 210 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp53_ = windowsrc;
#line 210 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp54_ = soy__client_thread;
#line 210 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp55_ = _tmp54_->context;
#line 210 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		g_source_attach ((GSource*) _tmp53_, _tmp55_);
#line 127 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		configs = (g_free (configs), NULL);
#line 127 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		ctx_attrs = (g_free (ctx_attrs), NULL);
#line 127 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		egl_attrs = (g_free (egl_attrs), NULL);
#line 555 "Client.c"
	}
#line 213 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp56_ = self->priv->_xWindow;
#line 213 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if (_tmp56_ == NULL) {
#line 561 "Client.c"
		Screen* screen = NULL;
		Display* _tmp57_ = NULL;
		Screen* _tmp58_ = NULL;
		Screen* _tmp59_ = NULL;
		Colormap _tmp60_ = {0};
		Display* _tmp61_ = NULL;
		Display* _tmp62_ = NULL;
		Window _tmp63_ = 0;
		XVisualInfo _tmp64_ = {0};
		gint _tmp65_ = 0;
		XVisualInfo _tmp66_ = {0};
		Visual* _tmp67_ = NULL;
		Window _tmp68_ = 0;
		Window* _tmp69_ = NULL;
		soywidgetsWindow* _tmp70_ = NULL;
		Window* _tmp71_ = NULL;
#line 216 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp57_ = self->xDisplay;
#line 216 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp58_ = XDefaultScreenOfDisplay (_tmp57_);
#line 216 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		screen = _tmp58_;
#line 217 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp59_ = screen;
#line 217 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp60_ = DefaultColormapOfScreen (_tmp59_);
#line 217 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		winattr.colormap = _tmp60_;
#line 220 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		winattr.event_mask = (glong) ((((((ExposureMask | StructureNotifyMask) | KeyPressMask) | KeyReleaseMask) | ButtonPressMask) | ButtonReleaseMask) | PointerMotionMask);
#line 231 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		winattr.override_redirect = FALSE;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp61_ = self->xDisplay;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp62_ = self->xDisplay;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp63_ = DefaultRootWindow (_tmp62_);
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp64_ = self->priv->_xVisInfo;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp65_ = _tmp64_.depth;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp66_ = self->priv->_xVisInfo;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp67_ = _tmp66_.visual;
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp68_ = XCreateWindow (_tmp61_, _tmp63_, 0, 0, (guint) 1023, (guint) 768, (guint) 0, _tmp65_, (guint) InputOutput, _tmp67_, (CWColormap | CWEventMask) | CWOverrideRedirect, &winattr);
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp69_ = __window_dup0 (&_tmp68_);
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_g_free0 (self->priv->_xWindow);
#line 232 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->priv->_xWindow = _tmp69_;
#line 247 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp70_ = self->priv->_window;
#line 247 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp71_ = self->priv->_xWindow;
#line 247 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp70_->windowid = (guint) (*_tmp71_);
#line 622 "Client.c"
	}
#line 249 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	result = TRUE;
#line 249 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return result;
#line 628 "Client.c"
}


void soy_client_window_client (soyClient* self, XClientMessageEvent* event) {
	XClientMessageEvent _tmp0_ = {0};
	glong* _tmp1_ = NULL;
	gint _tmp1__length1 = 0;
	glong _tmp2_ = 0L;
	Atom _tmp3_ = {0};
#line 251 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (self != NULL);
#line 251 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (event != NULL);
#line 252 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = *event;
#line 252 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp1_ = _tmp0_.data.l;
#line 252 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp1__length1 = -1;
#line 252 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp2_ = _tmp1_[0];
#line 252 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp3_ = self->priv->_wm_delete_window;
#line 252 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if (((Atom) _tmp2_) == _tmp3_) {
#line 254 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		g_signal_emit_by_name (self, "on-close");
#line 257 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		self->closing = TRUE;
#line 658 "Client.c"
	}
}


void soy_client_window_config (soyClient* self, XConfigureEvent* event) {
	XConfigureEvent _tmp0_ = {0};
	Window _tmp1_ = 0;
	Window* _tmp2_ = NULL;
	soywidgetsWindow* _tmp3_ = NULL;
	soyatomsPosition* _tmp4_ = NULL;
	soyatomsPosition* _tmp5_ = NULL;
	soyatomsPosition* _tmp6_ = NULL;
	XConfigureEvent _tmp7_ = {0};
	gint _tmp8_ = 0;
	XConfigureEvent _tmp9_ = {0};
	gint _tmp10_ = 0;
	soywidgetsWindow* _tmp11_ = NULL;
	soyatomsSize* _tmp12_ = NULL;
	soyatomsSize* _tmp13_ = NULL;
	soyatomsSize* _tmp14_ = NULL;
	XConfigureEvent _tmp15_ = {0};
	gint _tmp16_ = 0;
	XConfigureEvent _tmp17_ = {0};
	gint _tmp18_ = 0;
	soywidgetsWindow* _tmp19_ = NULL;
#line 259 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (self != NULL);
#line 259 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (event != NULL);
#line 261 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = *event;
#line 261 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp1_ = _tmp0_.window;
#line 261 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp2_ = self->priv->_xWindow;
#line 261 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if ((_tmp1_) != (*_tmp2_)) {
#line 262 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		return;
#line 698 "Client.c"
	}
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp3_ = self->priv->_window;
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp4_ = soy_widgets_window_get_position (_tmp3_);
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp5_ = _tmp4_;
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp6_ = _tmp5_;
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp7_ = *event;
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp8_ = _tmp7_.x;
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp9_ = *event;
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp10_ = _tmp9_.y;
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	soy_atoms_position_set (_tmp6_, (gfloat) _tmp8_, (gfloat) _tmp10_, 0.0f);
#line 270 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_object_unref0 (_tmp6_);
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp11_ = self->priv->_window;
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp12_ = soy_widgets_widget_get_size ((soywidgetsWidget*) _tmp11_);
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp13_ = _tmp12_;
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp14_ = _tmp13_;
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp15_ = *event;
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp16_ = _tmp15_.width;
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp17_ = *event;
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp18_ = _tmp17_.height;
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	soy_atoms_size_set (_tmp14_, (gfloat) _tmp16_, (gfloat) _tmp18_, 0.0f);
#line 271 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_object_unref0 (_tmp14_);
#line 275 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp19_ = self->priv->_window;
#line 275 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	((soywidgetsWidget*) _tmp19_)->resized = FALSE;
#line 744 "Client.c"
}


void soy_client_window_draw (soyClient* self, XExposeEvent* event) {
	XExposeEvent _tmp0_ = {0};
	Window _tmp1_ = 0;
	Window* _tmp2_ = NULL;
	EGLSurface* _tmp3_ = NULL;
	EGLDisplay _tmp4_ = 0;
	EGLSurface* _tmp5_ = NULL;
	EGLSurface* _tmp6_ = NULL;
	EGLContext _tmp7_ = 0;
	soywidgetsWindow* _tmp8_ = NULL;
	EGLDisplay _tmp9_ = 0;
	EGLSurface* _tmp10_ = NULL;
#line 278 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (self != NULL);
#line 278 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (event != NULL);
#line 280 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = *event;
#line 280 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp1_ = _tmp0_.window;
#line 280 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp2_ = self->priv->_xWindow;
#line 280 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if ((_tmp1_) != (*_tmp2_)) {
#line 281 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		return;
#line 774 "Client.c"
	}
#line 284 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp3_ = self->priv->_eglSurface;
#line 284 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if (_tmp3_ == NULL) {
#line 285 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		return;
#line 782 "Client.c"
	}
#line 288 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp4_ = self->priv->_eglDisplay;
#line 288 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp5_ = self->priv->_eglSurface;
#line 288 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp6_ = self->priv->_eglSurface;
#line 288 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp7_ = self->priv->_eglContext;
#line 288 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	eglMakeCurrent (_tmp4_, *_tmp5_, *_tmp6_, _tmp7_);
#line 291 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp8_ = self->priv->_window;
#line 291 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	soy_widgets_window_draw (_tmp8_);
#line 294 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp9_ = self->priv->_eglDisplay;
#line 294 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp10_ = self->priv->_eglSurface;
#line 294 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	eglSwapBuffers (_tmp9_, *_tmp10_);
#line 804 "Client.c"
}


static EGLSurface* _egl_surface_dup (EGLSurface* self) {
	EGLSurface* dup;
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	dup = g_new0 (EGLSurface, 1);
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	memcpy (dup, self, sizeof (EGLSurface));
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return dup;
#line 816 "Client.c"
}


static gpointer __egl_surface_dup0 (gpointer self) {
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return self ? _egl_surface_dup (self) : NULL;
#line 823 "Client.c"
}


void soy_client_window_opened (soyClient* self, XCreateWindowEvent* event) {
	XCreateWindowEvent _tmp0_ = {0};
	Window _tmp1_ = 0;
	Window* _tmp2_ = NULL;
	Display* _tmp3_ = NULL;
	Window* _tmp4_ = NULL;
	Display* _tmp5_ = NULL;
	Atom _tmp6_ = {0};
	Display* _tmp7_ = NULL;
	Window* _tmp8_ = NULL;
	Atom _tmp9_ = {0};
	Atom* _tmp10_ = NULL;
	Atom* _tmp11_ = NULL;
	gint _tmp11__length1 = 0;
	EGLDisplay _tmp12_ = 0;
	EGLConfig _tmp13_ = 0;
	Window* _tmp14_ = NULL;
	EGLSurface _tmp15_ = 0;
	EGLSurface* _tmp16_ = NULL;
	Display* _tmp17_ = NULL;
#line 297 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (self != NULL);
#line 297 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (event != NULL);
#line 299 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = *event;
#line 299 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp1_ = _tmp0_.window;
#line 299 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp2_ = self->priv->_xWindow;
#line 299 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if ((_tmp1_) != (*_tmp2_)) {
#line 300 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		return;
#line 861 "Client.c"
	}
#line 303 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp3_ = self->xDisplay;
#line 303 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp4_ = self->priv->_xWindow;
#line 303 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	XMapWindow (_tmp3_, *_tmp4_);
#line 306 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp5_ = self->xDisplay;
#line 306 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp6_ = XInternAtom (_tmp5_, "WM_DELETE_WINDOW", FALSE);
#line 306 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self->priv->_wm_delete_window = _tmp6_;
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp7_ = self->xDisplay;
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp8_ = self->priv->_xWindow;
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp9_ = self->priv->_wm_delete_window;
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp10_ = g_new0 (Atom, 1);
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp10_[0] = _tmp9_;
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp11_ = _tmp10_;
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp11__length1 = 1;
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	XSetWMProtocols (_tmp7_, *_tmp8_, _tmp11_, 1);
#line 307 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp11_ = (g_free (_tmp11_), NULL);
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp12_ = self->priv->_eglDisplay;
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp13_ = self->priv->_eglConfig;
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp14_ = self->priv->_xWindow;
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp15_ = eglCreateWindowSurface (_tmp12_, _tmp13_, *_tmp14_, NULL);
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp16_ = __egl_surface_dup0 (&_tmp15_);
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_free0 (self->priv->_eglSurface);
#line 310 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self->priv->_eglSurface = _tmp16_;
#line 316 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp17_ = self->xDisplay;
#line 316 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	XFlush (_tmp17_);
#line 911 "Client.c"
}


void soy_client_window_resize (soyClient* self, soyatomsSize* size) {
#line 319 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (self != NULL);
#line 319 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_if_fail (size != NULL);
#line 320 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return;
#line 922 "Client.c"
}


soyClient* soy_client_construct (GType object_type) {
	soyClient * self = NULL;
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self = (soyClient*) g_object_new (object_type, NULL);
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return self;
#line 932 "Client.c"
}


soyClient* soy_client_new (void) {
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return soy_client_construct (SOY_TYPE_CLIENT);
#line 939 "Client.c"
}


const gchar* soy_client_get_address (soyClient* self) {
	const gchar* result;
	const gchar* _tmp0_ = NULL;
#line 30 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_val_if_fail (self != NULL, NULL);
#line 30 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = self->priv->_address;
#line 30 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	result = _tmp0_;
#line 30 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return result;
#line 954 "Client.c"
}


soywidgetsWindow* soy_client_get_window (soyClient* self) {
	soywidgetsWindow* result;
	soywidgetsWindow* _tmp0_ = NULL;
#line 32 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_return_val_if_fail (self != NULL, NULL);
#line 32 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = self->priv->_window;
#line 32 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	result = _tmp0_;
#line 32 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return result;
#line 969 "Client.c"
}


static void _soy_client_window_resize_soy_atoms_size_on_set (soyatomsSize* _sender, soyatomsSize* size, gpointer self) {
#line 55 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	soy_client_window_resize (self, size);
#line 976 "Client.c"
}


static gboolean _soy_client_thread_step_gsource_func (gpointer self) {
	gboolean result;
	result = soy_client_thread_step (self);
#line 75 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return result;
#line 985 "Client.c"
}


static GObject * soy_client_constructor (GType type, guint n_construct_properties, GObjectConstructParam * construct_properties) {
	GObject * obj;
	GObjectClass * parent_class;
	soyClient * self;
	gchar* _tmp0_ = NULL;
	soywidgetsWindow* _tmp1_ = NULL;
	soywidgetsWindow* _tmp2_ = NULL;
	soyatomsSize* _tmp3_ = NULL;
	soyatomsSize* _tmp4_ = NULL;
	soyatomsSize* _tmp5_ = NULL;
	soy_ClientThread* _tmp6_ = NULL;
	GSource* source = NULL;
	GSource* _tmp8_ = NULL;
	GSource* _tmp9_ = NULL;
	GSource* _tmp10_ = NULL;
	soy_ClientThread* _tmp11_ = NULL;
	GMainContext* _tmp12_ = NULL;
#line 46 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	parent_class = G_OBJECT_CLASS (soy_client_parent_class);
#line 46 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	obj = parent_class->constructor (type, n_construct_properties, construct_properties);
#line 46 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, SOY_TYPE_CLIENT, soyClient);
#line 48 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp0_ = g_strdup ("");
#line 48 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_free0 (self->priv->_address);
#line 48 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self->priv->_address = _tmp0_;
#line 51 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp1_ = soy_widgets_window_new ();
#line 51 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_object_unref0 (self->priv->_window);
#line 51 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self->priv->_window = _tmp1_;
#line 54 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp2_ = self->priv->_window;
#line 54 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp3_ = soy_widgets_widget_get_size ((soywidgetsWidget*) _tmp2_);
#line 54 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp4_ = _tmp3_;
#line 54 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_object_unref0 (self->priv->_window_size);
#line 54 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self->priv->_window_size = _tmp4_;
#line 55 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp5_ = self->priv->_window_size;
#line 55 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_signal_connect_object (_tmp5_, "on-set", (GCallback) _soy_client_window_resize_soy_atoms_size_on_set, self, 0);
#line 70 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp6_ = soy__client_thread;
#line 70 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	if (_tmp6_ == NULL) {
#line 1042 "Client.c"
		soy_ClientThread* _tmp7_ = NULL;
#line 71 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp7_ = soy__clientthread_new ();
#line 71 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_g_object_unref0 (soy__client_thread);
#line 71 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		soy__client_thread = _tmp7_;
#line 1050 "Client.c"
	}
#line 74 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp8_ = g_timeout_source_new ((guint) 25);
#line 74 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	source = _tmp8_;
#line 75 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp9_ = source;
#line 75 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_source_set_callback (_tmp9_, _soy_client_thread_step_gsource_func, g_object_ref (self), g_object_unref);
#line 76 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp10_ = source;
#line 76 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp11_ = soy__client_thread;
#line 76 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_tmp12_ = _tmp11_->context;
#line 76 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_source_attach (_tmp10_, _tmp12_);
#line 46 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_source_unref0 (source);
#line 46 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	return obj;
#line 1072 "Client.c"
}


static void soy_client_class_init (soyClientClass * klass) {
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	soy_client_parent_class = g_type_class_peek_parent (klass);
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_type_class_add_private (klass, sizeof (soyClientPrivate));
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	G_OBJECT_CLASS (klass)->get_property = _vala_soy_client_get_property;
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	G_OBJECT_CLASS (klass)->constructor = soy_client_constructor;
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	G_OBJECT_CLASS (klass)->finalize = soy_client_finalize;
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_object_class_install_property (G_OBJECT_CLASS (klass), SOY_CLIENT_ADDRESS, g_param_spec_string ("address", "address", "address", NULL, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_object_class_install_property (G_OBJECT_CLASS (klass), SOY_CLIENT_WINDOW, g_param_spec_object ("window", "window", "window", SOY_WIDGETS_TYPE_WINDOW, G_PARAM_STATIC_NAME | G_PARAM_STATIC_NICK | G_PARAM_STATIC_BLURB | G_PARAM_READABLE));
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	g_signal_new ("on_close", SOY_TYPE_CLIENT, G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
#line 1093 "Client.c"
}


static void soy_client_instance_init (soyClient * self) {
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self->priv = SOY_CLIENT_GET_PRIVATE (self);
#line 1100 "Client.c"
}


static void soy_client_finalize (GObject* obj) {
	soyClient * self;
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, SOY_TYPE_CLIENT, soyClient);
#line 80 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	while (TRUE) {
#line 1110 "Client.c"
		Display* _tmp0_ = NULL;
#line 80 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		_tmp0_ = self->xDisplay;
#line 80 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		if (!(_tmp0_ != NULL)) {
#line 80 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
			break;
#line 1118 "Client.c"
		}
#line 81 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		g_usleep ((gulong) 10);
#line 1122 "Client.c"
	}
#line 30 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_free0 (self->priv->_address);
#line 32 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_object_unref0 (self->priv->_window);
#line 38 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_free0 (self->priv->_eglSurface);
#line 39 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_object_unref0 (self->priv->_window_size);
#line 41 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_XCloseDisplay0 (self->xDisplay);
#line 43 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	_g_free0 (self->priv->_xWindow);
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	G_OBJECT_CLASS (soy_client_parent_class)->finalize (obj);
#line 1138 "Client.c"
}


GType soy_client_get_type (void) {
	static volatile gsize soy_client_type_id__volatile = 0;
	if (g_once_init_enter (&soy_client_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (soyClientClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) soy_client_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (soyClient), 0, (GInstanceInitFunc) soy_client_instance_init, NULL };
		GType soy_client_type_id;
		soy_client_type_id = g_type_register_static (G_TYPE_OBJECT, "soyClient", &g_define_type_info, 0);
		g_once_init_leave (&soy_client_type_id__volatile, soy_client_type_id);
	}
	return soy_client_type_id__volatile;
}


static void _vala_soy_client_get_property (GObject * object, guint property_id, GValue * value, GParamSpec * pspec) {
	soyClient * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (object, SOY_TYPE_CLIENT, soyClient);
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
	switch (property_id) {
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		case SOY_CLIENT_ADDRESS:
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		g_value_set_string (value, soy_client_get_address (self));
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		break;
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		case SOY_CLIENT_WINDOW:
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		g_value_set_object (value, soy_client_get_window (self));
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		break;
#line 1171 "Client.c"
		default:
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
#line 27 "/home/jeff/Documents/libraries/libsoy/platforms/x11/Client.gs"
		break;
#line 1177 "Client.c"
	}
}



